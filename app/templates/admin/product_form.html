{% extends "admin/base.html" %}

{% block layout %}
<div class="admin-shell">
    {% include "admin/partials/sidebar.html" %}
    <main class="admin-content">
        <header class="admin-header">
            <h1>{{ form_title }}</h1>
            <a class="btn ghost" href="/admin/products">Back to list</a>
        </header>
        <section class="panel">
            <header>
                <div>
                    <h2>Product details</h2>
                    <p class="panel-subtitle">Provide the required identifiers and optional metadata.</p>
                </div>
            </header>
            <form class="admin-form" method="post" action="{{ form_action }}" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
                {% if form_error %}
                <div class="form-error" role="alert">{{ form_error }}</div>
                {% endif %}
                <label>
                    Name
                    <input name="name" type="text" required value="{{ form_data.name }}" />
                </label>
                <label>
                    SKU
                    <input name="sku" type="text" required value="{{ form_data.sku }}" />
                </label>
                <label>
                    OEM number
                    <input name="oem_number" type="text" required value="{{ form_data.oem_number }}" />
                </label>
                <label>
                    Summary
                    <textarea name="summary" rows="4" placeholder="Optional description for internal context.">{{ form_data.summary }}</textarea>
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" name="is_active" value="true" {% if form_data.is_active %}checked{% endif %} />
                    <span>Visible on site</span>
                </label>
                <label>
                    Category
                    <select name="category_id">
                        <option value="">Unassigned</option>
                        {% for category in categories %}
                        <option value="{{ category.id_str }}" {% if form_data.category_id == category.id_str %}selected{% endif %}>{{ category.label }}</option>
                        {% endfor %}
                    </select>
                </label>
                <section class="image-manager">
                    <header>
                        <h3>Images</h3>
                        <p class="panel-subtitle">Upload, reorder, or remove gallery images.</p>
                    </header>
                    {% if existing_images %}
                    <ul class="image-list">
                        {% for image in existing_images %}
                        <li class="image-card">
                            <div class="image-card-header">
                                <img src="{{ image.url }}" alt="{{ image.alt_text or form_data.name or 'Product image' }}" loading="lazy" />
                            </div>
                            <div class="image-card-body">
                                <label>
                                    Alt text
                                    <input type="text" name="existing_image_alt_{{ image.id }}" value="{{ image.alt_text }}" />
                                </label>
                                <div class="image-field-row">
                                    <label>
                                        Display order
                                        <input type="number" name="existing_image_order_{{ image.id }}" value="{{ image.sort_order }}" />
                                    </label>
                                    <label class="checkbox-inline">
                                        <input type="checkbox" name="existing_image_delete_{{ image.id }}" {% if image.pending_delete %}checked{% endif %} />
                                        <span>Remove image</span>
                                    </label>
                                </div>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="field-note">No images yet. Upload files below to populate the gallery.</p>
                    {% endif %}
                    <label>
                        Upload new images
                        <input type="file" name="new_images" accept="image/*" multiple />
                    </label>
                    <p class="field-note">New uploads are added after you save. Set final order/alt text by editing the product again if needed.</p>
                </section>
                <div class="form-actions">
                    <button class="btn ghost" type="reset">Reset</button>
                    <button class="btn primary" type="submit">{{ submit_label }}</button>
                </div>
            </form>
        </section>
    </main>
</div>
{% endblock %}
