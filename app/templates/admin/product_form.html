{% extends "admin/base.html" %}

{% block layout %}
<div class="admin-shell">
    {% include "admin/partials/sidebar.html" %}
    <main class="admin-content">
        <header class="admin-header">
            <h1>{{ form_title }}</h1>
            <a class="btn ghost" href="/admin/products">Back to list</a>
        </header>
        <section class="panel">
            <header>
                <div>
                    <h2>Product details</h2>
                    <p class="panel-subtitle">Provide the required identifiers and optional metadata.</p>
                </div>
            </header>
            <form class="admin-form" method="post" action="{{ form_action }}" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
                {% if form_error %}
                <div class="form-error" role="alert">{{ form_error }}</div>
                {% endif %}
                <div class="grid-2">
                    <label>
                        Name
                        <input name="name" type="text" required value="{{ form_data.name }}" />
                    </label>
                    <label>
                        SKU
                        <input name="sku" type="text" required value="{{ form_data.sku }}" />
                    </label>
                </div>
                <div class="grid-2">
                    <label>
                        OEM number
                        <input name="oem_number" type="text" required value="{{ form_data.oem_number }}" />
                    </label>
                    <label>
                        Category
                        <select name="category_id">
                            <option value="">Unassigned</option>
                            {% for category in categories %}
                            <option value="{{ category.id_str }}" {% if form_data.category_id == category.id_str %}selected{% endif %}>{{ category.label }}</option>
                            {% endfor %}
                        </select>
                    </label>
                </div>
                <div class="toggle-field">
                    <span class="toggle-title">Status</span>
                    <label class="toggle-switch">
                        <input type="checkbox" name="is_active" value="true" {% if form_data.is_active %}checked{% endif %} />
                        <span class="toggle-slider" aria-hidden="true"></span>
                        <span class="toggle-state">
                            <span class="toggle-state-on">Active</span>
                            <span class="toggle-state-off">Inactive</span>
                        </span>
                    </label>
                    <p class="field-note">Active products appear in the public catalog.</p>
                </div>
                <div class="rich-field" data-rich-editor>
                    <span class="field-label">Summary</span>
                    <div class="rich-toolbar" role="toolbar" aria-label="Summary formatting">
                        <select data-command="fontName" aria-label="Font family">
                            <option value="">Font</option>
                            <option value="Inter">Inter</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Arial">Arial</option>
                            <option value="Courier New">Courier New</option>
                        </select>
                        <select data-command="fontSize" aria-label="Font size">
                            <option value="">Size</option>
                            <option value="2">Small</option>
                            <option value="3">Normal</option>
                            <option value="4">Large</option>
                            <option value="5">X-Large</option>
                        </select>
                        <button class="rich-btn" type="button" data-command="bold" aria-label="Bold"><strong>B</strong></button>
                        <button class="rich-btn" type="button" data-command="italic" aria-label="Italic"><em>I</em></button>
                        <button class="rich-btn underline" type="button" data-command="underline" aria-label="Underline">U</button>
                        <button class="rich-btn" type="button" data-command="createLink" aria-label="Insert link">Link</button>
                        <input type="color" value="#0ea5e9" data-command="foreColor" aria-label="Text color" />
                    </div>
                    <div class="rich-editor" contenteditable="true" data-rich-editor-area data-placeholder="Add a product summary..." aria-label="Product summary">{{ form_data.summary|markdown }}</div>
                    <textarea class="sr-only" name="summary" data-rich-input>{{ form_data.summary }}</textarea>
                    <p class="field-note">Format descriptions with fonts, sizes, links, and colors.</p>
                </div>
                <section class="image-manager">
                    <header>
                        <h3>Images</h3>
                        <p class="panel-subtitle">Upload, reorder, or remove gallery images.</p>
                    </header>
                    {% if existing_images %}
                    <ul class="image-list">
                        {% for image in existing_images %}
                        <li class="image-card">
                            <div class="image-card-header">
                                <img src="{{ image.url }}" alt="{{ image.alt_text or form_data.name or 'Product image' }}" loading="lazy" />
                            </div>
                            <div class="image-card-body">
                                <label>
                                    Alt text
                                    <input type="text" name="existing_image_alt_{{ image.id }}" value="{{ image.alt_text }}" />
                                </label>
                                <div class="image-field-row">
                                    <label>
                                        Display order
                                        <input type="number" name="existing_image_order_{{ image.id }}" value="{{ image.sort_order }}" />
                                    </label>
                                    <div class="image-delete">
                                        <input class="sr-only image-delete-checkbox" type="checkbox" id="delete-image-{{ image.id }}" name="existing_image_delete_{{ image.id }}" {% if image.pending_delete %}checked{% endif %} />
                                        <button class="btn danger image-delete-btn" type="button" data-image-delete-button data-target="delete-image-{{ image.id }}">Remove image</button>
                                        <span class="image-delete-note" aria-live="polite">Marked for removal</span>
                                    </div>
                                </div>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="field-note">No images yet. Upload files below to populate the gallery.</p>
                    {% endif %}
                    <label>
                        Upload new images
                        <input type="file" name="new_images" accept="image/*" multiple />
                    </label>
                    <p class="field-note">New uploads are added after you save. Set final order/alt text by editing the product again if needed.</p>
                </section>
                <div class="form-actions">
                    <button class="btn ghost" type="reset">Reset</button>
                    <button class="btn primary" type="submit">{{ submit_label }}</button>
                </div>
            </form>
        </section>
    </main>
</div>
{% endblock %}
