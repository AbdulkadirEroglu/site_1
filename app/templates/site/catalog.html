{% extends "site/base.html" %}

{% block content %}
<section class="page-header">
    <h1>Product Catalog</h1>
    <p>Browse our live inventory of OEM-certified spare parts sourced from trusted manufacturers.</p>
</section>
<section class="catalog-layout">
    <aside class="catalog-sidebar">
        <h2>Filters</h2>
        <form class="catalog-filters" method="get">
            <div class="filter-group">
                <label for="filter-keyword">Keyword</label>
                <input id="filter-keyword" name="q" type="search" placeholder="Search catalog" value="{{ filters.q }}" />
            </div>
            <div class="filter-group">
                <label for="filter-category">Category</label>
                <select id="filter-category" name="category">
                    <option value="">All categories</option>
                    {% for category in categories %}
                    <option value="{{ category.slug }}" {% if filters.category == category.slug %}selected{% endif %}>{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-oem">OEM reference</label>
                <input id="filter-oem" name="oem" type="text" placeholder="e.g. OEM 4712-A" value="{{ filters.oem }}" />
            </div>
            <div class="filter-actions">
                <button type="submit" class="btn secondary">Apply filters</button>
                {% if filters.has_active %}
                <a class="btn ghost" href="/catalog">Clear</a>
                {% endif %}
            </div>
        </form>
    </aside>
    <div class="catalog-results">
        {% if products %}
        <div class="catalog-grid">
            {% for product in products %}
            <article class="catalog-card">
                <a href="/products/{{ product.id }}" class="catalog-card-link" aria-label="View {{ product.name }} details">
                    {% if product.primary_image %}
                    <figure class="catalog-image">
                        <img src="{{ product.primary_image.url }}" alt="{{ product.primary_image.alt }}" loading="lazy" />
                    </figure>
                    {% else %}
                    <div class="placeholder-image"></div>
                    {% endif %}
                </a>
                <div class="catalog-card-content">
                    <div class="catalog-title">
                        <h3><a href="/products/{{ product.id }}">{{ product.name }}</a></h3>
                        <p class="catalog-meta">OEM {{ product.oem_number }} · Part {{ product.sku }}</p>
                    </div>
                    {% if product.category %}
                    <p class="catalog-meta">Category · {{ product.category }}</p>
                    {% endif %}
                    {% if product.images|length > 1 %}
                    <ul class="catalog-thumbs" aria-label="Additional images">
                        {% for image in product.images[1:] %}
                        <li>
                            <img src="{{ image.url }}" alt="{{ image.alt }}" loading="lazy" />
                        </li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    <div class="card-actions">
                        <a class="btn ghost" href="/products/{{ product.id }}">View details</a>
                        <form method="post" action="/cart/add">
                            <input type="hidden" name="product_id" value="{{ product.id }}" />
                            <input type="hidden" name="redirect_to" value="{{ request.url.path }}" />
                            <button class="btn primary" type="submit">Add to cart</button>
                        </form>
                    </div>
                </div>
            </article>
            {% endfor %}
        </div>
        {% else %}
        <p class="empty-state">
            {% if filters.has_active %}
            No products matched your filters. Try adjusting the criteria.
            {% else %}
            No products found yet. Use the admin dashboard to add the first items.
            {% endif %}
        </p>
        {% endif %}
    </div>
</section>
{% endblock %}
